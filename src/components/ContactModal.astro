---
---

<div id="contactModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
  <div class="bg-gray-900 border border-violet-500/30 rounded-2xl p-8 max-w-md w-full">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-violet-300">Contacta con nosotros</h2>
      <button id="closeModal" class="text-gray-400 hover:text-violet-400 transition cursor-pointer">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Toast de alerta -->
    <div id="alertToast" class="hidden fixed top-4 right-4 z-[60] animate-fade-in">
      <div id="alertContent" class="bg-green-500/20 border border-green-500/50 rounded-lg px-4 py-3 text-green-200 max-w-sm">
        <p id="alertMessage"></p>
      </div>
    </div>
    
    <form id="contactForm" class="space-y-4">
      <div>
        <label class="block text-sm font-semibold text-gray-300 mb-2">Nombre</label>
        <input
          type="text"
          name="name"
          required
          class="w-full px-4 py-2 bg-gray-800 border border-violet-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/60 transition"
          placeholder="Tu nombre"
        />
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-300 mb-2">Email</label>
        <input
          type="email"
          name="email"
          required
          class="w-full px-4 py-2 bg-gray-800 border border-violet-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/60 transition"
          placeholder="tu@email.com"
        />
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-300 mb-2">Proyecto</label>
        <select
          name="project"
          class="w-full px-4 py-2 bg-gray-800 border border-violet-500/30 rounded-lg text-white focus:outline-none focus:border-violet-500/60 transition"
        >
          <option value="">Selecciona un tipo de proyecto</option>
          <option value="landing">Landing Page</option>
          <option value="webapp">Aplicación Web</option>
          <option value="ecommerce">E-commerce</option>
          <option value="custom">Otro</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-300 mb-2">Mensaje</label>
        <textarea
          name="message"
          rows="4"
          class="w-full px-4 py-2 bg-gray-800 border border-violet-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/60 transition resize-none"
          placeholder="Cuéntanos sobre tu proyecto..."
        ></textarea>
      </div>
      
      <button
        type="submit"
        class="w-full px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 rounded-lg font-semibold transition text-white cursor-pointer"
      >
        Enviar Mensaje
      </button>
    </form>
  </div>
</div>

<script is:inline>
  function initModal() {
    const modal = document.getElementById('contactModal');
    const closeBtn = document.getElementById('closeModal');
    const contactForm = document.getElementById('contactForm');
    const contactBtns = document.querySelectorAll('[data-contact-modal]');

    if (!modal || !closeBtn || !contactForm) {
      console.error('Modal elements not found');
      return;
    }

    // Abrir modal
    contactBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });
    });

    // Cerrar modal
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    function closeModal() {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
      contactForm.reset();
    }

    // Función para mostrar alerta
    function showAlert(message, type = 'success') {
      const alertToast = document.getElementById('alertToast');
      const alertContent = document.getElementById('alertContent');
      const alertMessage = document.getElementById('alertMessage');

      alertMessage.textContent = message;
      
      if (type === 'success') {
        alertContent.className = 'bg-green-500/20 border border-green-500/50 rounded-lg px-4 py-3 text-green-200 max-w-sm';
      } else if (type === 'error') {
        alertContent.className = 'bg-red-500/20 border border-red-500/50 rounded-lg px-4 py-3 text-red-200 max-w-sm';
      }

      alertToast.classList.remove('hidden');
      
      setTimeout(() => {
        alertToast.classList.add('hidden');
      }, 4000);
    }

    // Manejar envío del formulario
    contactForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = contactForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';

      try {
        const formData = {
          name: contactForm.querySelector('input[name="name"]').value,
          email: contactForm.querySelector('input[name="email"]').value,
          project: contactForm.querySelector('select[name="project"]').value,
          message: contactForm.querySelector('textarea[name="message"]').value,
        };

        const response = await fetch('/.netlify/functions/sendEmail', {
          method: 'POST',
          body: JSON.stringify(formData),
        });

        const result = await response.json();

        if (response.ok) {
          showAlert('¡Gracias! Tu mensaje ha sido enviado correctamente. Te responderemos pronto.', 'success');
          contactForm.reset();
          setTimeout(() => closeModal(), 2000);
        } else {
          showAlert('Error al enviar el mensaje: ' + (result.error || 'Intenta nuevamente'), 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showAlert('Error al enviar el mensaje. Intenta nuevamente.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  }

  // Esperar a que el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initModal);
  } else {
    initModal();
  }
</script>