---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Acceso Administrativo">
  <main style="max-width: 600px; margin: 100px auto; text-align: center; font-family: sans-serif;">
    <h1 style="margin-bottom: 20px;">Panel de Control Odyssey</h1>
    
    <button 
      id="login-btn"
      style="background: #7f13ec; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;"
    >
      Iniciar Sesión / Confirmar Cuenta
    </button>

    <p style="margin-top: 30px;">
      <a href="/" style="color: #666; text-decoration: none;">← Volver al inicio</a>
    </p>
  </main>

  <script is:inline src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <script is:inline>
    // 1. Inicializar
    window.netlifyIdentity.init();

    // 2. Abrir al hacer clic en el botón
    document.getElementById('login-btn').addEventListener('click', () => {
      window.netlifyIdentity.open(); 
    });

    // 3. Manejar el login
    window.netlifyIdentity.on('login', () => {
      window.location.href = '/admin/';
    });

    // 4. Si el usuario viene desde el mail (con un token en la URL), abrir el modal de confirmación
    if (window.location.hash.includes('_token=')) {
        window.netlifyIdentity.open();
    }
  </script>
</Layout>