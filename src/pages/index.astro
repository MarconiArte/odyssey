---
import Layout from '../layouts/Layout.astro';
import Welcome from '../components/Welcome.astro';
---

<Layout title="OdysseyDev - Desarrollo Web Premium">
	<Welcome />
	
	<script is:inline src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
	
	<script is:inline>
		// Esperamos a que el widget esté realmente disponible
		function checkIdentity() {
			if (window.netlifyIdentity) {
				window.netlifyIdentity.init();
				
				// Solo si hay token de invitación, forzamos la apertura
				if (window.location.hash.includes("invite_token")) {
					console.log("Token detectado, abriendo modal...");
					// Le damos un respiro para que cargue los estilos CSS del modal
					setTimeout(() => {
						window.netlifyIdentity.open("signup");
					}, 800);
				}
			} else {
				// Si no está listo, reintentamos en 100ms
				setTimeout(checkIdentity, 100);
			}
		}

		checkIdentity();

		// Redirección al loguearse
		if (window.netlifyIdentity) {
			window.netlifyIdentity.on('login', () => {
				window.location.href = '/admin/';
			});
		}
	</script>
</Layout>
